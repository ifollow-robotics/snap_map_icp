<!-- Snap Map ICP Launch-->
<launch>

  <arg name="use_global_loc" default="false"/>

  <node pkg="snap_map_icp" type="snap_map_icp" name="snap_map_icp" output="screen">

    <!-- relevant frames -->
    <param name="laser_frame" value="$(optenv ROBOT_ID robot_0)/base_link"/>
    <param name="odom_frame" value="$(optenv ROBOT_ID robot_0)/odom" />
    <param name="base_frame" value="$(optenv ROBOT_ID robot_0)/base_link" />
    <param name="global_frame" value="$(optenv ROBOT_ID robot_0)/map"/>

    <remap from="/scan" to="/lidar/scan_fused"/>

    <!-- <group unless="$(arg should_record)">
        <remap from="/initialpose" to="/initialposeglobal"/>
    </group> -->

    <remap unless="$(arg use_global_loc)" from="/initialpose" to="/initialposeglobal"/>

    <!-- defines minimum fitness for candidates for pose publishing -->
    <param name="icp_fitness_threshold" value="100"/>    <!-- analyzing the code, this is not even being used... -->

    <!-- accept only scans one second old or younger -->
    <param name="age_threshold" value="3"/>              <!-- how old (seconds) laser scans can be to be considered -->
    <param name="update_age_threshold" value="1"/>      <!-- only publish new pose after X scans -->

    <!-- thresholds over distance between amcl and icp pose to trigger pose publishing -->

    <!-- translation -->
    <param name="dist_threshold" value="0.1"/>          <!-- minimum position change that will trigger a re-initialisation of amcl -->
    <!-- rotation -->
    <param name="angle_threshold" value="0.01"/>         <!-- minimum angle change that will trigger a re-initialisation of amcl -->
    <param name="angle_upper_threshold" value="6.28"/>     <!-- max icp tf angle that will still be considered a sane match published as initial pose -->

    <!-- various icp parameters: consult with icp algorithm from pcl for details -->
    <param name="icp_inlier_threshold" value="0.74"/>    <!-- match quality -->
    <param name="icp_inlier_min_threshold" value="0.5"/>    <!-- Lower acceptable percentage of inliner (under == very dynamic environment or delocalization) -->
    <param name="icp_inlier_dist" value="0.15"/>        <!-- meters distance a point can have to its nearest neighbot in map to be still considered as inlier -->
    <param name="icp_num_iter" value="250"/>
    <param name="icp_max_corres_dist" value="90.0"/>
    <param name="pose_covariance_trans" value="0.5"/>   <!-- pose cov that the initial pose gets sent with -->
    <param name="inliers_buffer" value="5"/>   <!-- Number of scan's inlier to take into acocunt to change settings parameters -->

    <!-- rate at which scans are taken -->
    <param name="scan_rate" value="3"/>                <!-- we may decrease this to decrease computation load -->
  </node>
</launch>